version: '3.8'

services:
  # FAIRiAgent API Service
  fairifier-api:
    build:
      context: ..
      dockerfile: Dockerfile
    ports:
      - "8000:8000"
    environment:
      # Optional: Vector database (if using Qdrant)
      - QDRANT_URL=${QDRANT_URL:-http://qdrant:6333}
      # Optional: GROBID service (if using GROBID for PDF parsing)
      - GROBID_URL=${GROBID_URL:-http://grobid:8070}
      # FAIR-DS API (external service, not in docker compose)
      - FAIR_DS_API_URL=${FAIR_DS_API_URL:-http://host.docker.internal:8083}
      # LLM Configuration (set via .env file)
      - LLM_PROVIDER=${LLM_PROVIDER:-ollama}
      - FAIRIFIER_LLM_MODEL=${FAIRIFIER_LLM_MODEL:-}
      - LLM_API_KEY=${LLM_API_KEY:-}
      # LangSmith (optional)
      - LANGSMITH_API_KEY=${LANGSMITH_API_KEY:-}
      - LANGSMITH_PROJECT=${LANGSMITH_PROJECT:-fairifier}
    volumes:
      - ../output:/app/output
      - ../kb:/app/kb
    depends_on:
      - qdrant
      - grobid
    restart: unless-stopped

  # Vector database (optional - only if using Qdrant)
  qdrant:
    image: qdrant/qdrant:v1.7.0
    ports:
      - "6333:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    restart: unless-stopped

  # GROBID service for PDF parsing (optional)
  grobid:
    image: lfoppiano/grobid:0.8.0
    ports:
      - "8070:8070"
    restart: unless-stopped

volumes:
  qdrant_data:
