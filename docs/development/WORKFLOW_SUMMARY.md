# ğŸ“‹ å·¥ä½œæµç¨‹æ€»ç»“

## ğŸ¯ ç®€åŒ–çš„ 3 æ­¥å·¥ä½œæµ

å·²ç§»é™¤ Validator Agentï¼Œç°åœ¨å·¥ä½œæµæ›´åŠ ç®€æ´å’Œé«˜æ•ˆï¼š

```
Document Input
     â†“
Step 1: DocumentParser (LLM è‡ªé€‚åº”æå–)
     â”œâ”€ æ™ºèƒ½æå–æ–‡æ¡£ä¿¡æ¯
     â”œâ”€ é€‚åº”ä¸åŒæ–‡æ¡£ç±»å‹
     â””â”€ Critic è¯„ä¼° â†’ Accept/Retry/Escalate
     â†“
Step 2: KnowledgeRetriever (FAIR-DS çŸ¥è¯†æ£€ç´¢)
     â”œâ”€ è¿æ¥ FAIR-DS API
     â”œâ”€ æ™ºèƒ½é€‰æ‹©ç›¸å…³ packages å’Œ terms
     â””â”€ Critic è¯„ä¼° â†’ Accept/Retry/Escalate
     â†“
Step 3: JSONGenerator (å…ƒæ•°æ®ç”Ÿæˆ)
     â”œâ”€ åŠ¨æ€é€‰æ‹©ç›¸å…³å­—æ®µ
     â”œâ”€ ä¸ºæ¯ä¸ªå­—æ®µç”Ÿæˆå€¼
     â”œâ”€ æä¾›è¯æ®å’Œç½®ä¿¡åº¦
     â””â”€ Critic è¯„ä¼° â†’ Accept/Retry/Escalate
     â†“
Output: FAIR-DS å…¼å®¹çš„ JSON å…ƒæ•°æ®
```

---

## âœ… ä¸ºä»€ä¹ˆç§»é™¤ Validatorï¼Ÿ

### åŸå› ï¼š

1. **å†—ä½™è¯„ä¼°**
   - Critic Agent å·²ç»åœ¨æ¯æ­¥è¯„ä¼°è´¨é‡
   - JSONGenerator çš„ Critic è¯„ä¼°å·²åŒ…å«å®Œæ•´æ€§æ£€æŸ¥
   - ä¸éœ€è¦é¢å¤–çš„éªŒè¯æ­¥éª¤

2. **æ•ˆç‡ä¼˜åŒ–**
   - å‡å°‘ä¸€ä¸ªæ­¥éª¤ = æ›´å¿«çš„å¤„ç†é€Ÿåº¦
   - å‡å°‘ LLM è°ƒç”¨ = é™ä½æˆæœ¬
   - ç®€åŒ–æµç¨‹ = æ›´å®¹æ˜“ç†è§£å’Œç»´æŠ¤

3. **è´¨é‡ä¿è¯å·²å……åˆ†**
   - æ¯ä¸ª Agent éƒ½æœ‰ç½®ä¿¡åº¦è¯„åˆ†
   - Critic æä¾›è¯¦ç»†çš„è´¨é‡è¯„ä¼°
   - æ”¯æŒé‡è¯•å’Œäººå·¥å®¡æ ¸
   - metadata_fields æœ¬èº«åŒ…å« confidence å’Œ evidence

---

## ğŸ”„ Critic è¯„ä¼°å–ä»£äº† Validator

### JSONGenerator çš„ Critic è¯„ä¼°åŒ…æ‹¬ï¼š

```python
# Critic æ£€æŸ¥é¡¹ï¼š
âœ… å¿…éœ€å­—æ®µå®Œæ•´æ€§
âœ… å­—æ®µè´¨é‡ï¼ˆevidence, confidenceï¼‰
âœ… å¹³å‡ç½®ä¿¡åº¦
âœ… ç¼ºå¤±çš„å¿…éœ€å­—æ®µ
âœ… å­—æ®µæ•°é‡åˆç†æ€§
```

### è¯„ä¼°æ ‡å‡†ï¼š

```python
if confidence >= 0.75:
    decision = "ACCEPT"
    # è´¨é‡è‰¯å¥½ï¼Œæ‰€æœ‰å­—æ®µå®Œæ•´
    
elif confidence >= 0.5 and retry_count < max_retries:
    decision = "RETRY"
    # éœ€è¦æ”¹è¿›ï¼Œæä¾›å…·ä½“å»ºè®®
    
else:
    decision = "ESCALATE"
    # è´¨é‡ä¸è¶³ï¼Œéœ€è¦äººå·¥å®¡æ ¸
```

---

## ğŸ“Š æ–°çš„å·¥ä½œæµç¨‹ç»†èŠ‚

### Step 1: DocumentParser
**è¾“å…¥ï¼š** åŸå§‹æ–‡æ¡£æ–‡æœ¬

**å¤„ç†ï¼š**
- LLM è‡ªé€‚åº”æå–ä¿¡æ¯
- ä¸é™å®šå­—æ®µç±»å‹
- æ ¹æ®æ–‡æ¡£å†…å®¹å†³å®šæå–ä»€ä¹ˆ

**è¾“å‡ºï¼š** `document_info` dict

**Critic è¯„ä¼°ï¼š**
- æ ‡é¢˜ã€æ‘˜è¦ã€ä½œè€…å®Œæ•´æ€§
- æå–ä¿¡æ¯çš„å‡†ç¡®æ€§
- ç½®ä¿¡åº¦è¯„åˆ†

---

### Step 2: KnowledgeRetriever
**è¾“å…¥ï¼š** `document_info`

**å¤„ç†ï¼š**
- è¿æ¥ FAIR-DS APIï¼ˆä¸¥æ ¼æ¨¡å¼ï¼‰
- LLM æ™ºèƒ½é€‰æ‹©ç›¸å…³çš„ ISA å±‚çº§
- LLM é€‰æ‹©ç›¸å…³çš„ packages å’Œ terms

**è¾“å‡ºï¼š** `retrieved_knowledge` list

**Critic è¯„ä¼°ï¼š**
- çŸ¥è¯†é¡¹æ•°é‡å’Œè´¨é‡
- FAIR-DS packages è¯†åˆ«
- è¦†ç›–ç‡è¯„ä¼°

---

### Step 3: JSONGenerator
**è¾“å…¥ï¼š** `document_info` + `retrieved_knowledge`

**å¤„ç†ï¼š**
- LLM é€‰æ‹©æœ€ç›¸å…³çš„å­—æ®µï¼ˆ15-25ä¸ªï¼‰
- LLM ä¸ºæ¯ä¸ªå­—æ®µç”Ÿæˆå€¼
- æä¾› evidence å’Œ confidence

**è¾“å‡ºï¼š** `metadata_fields` list + `metadata_json`

**Critic è¯„ä¼°ï¼š**
- âœ… å¿…éœ€å­—æ®µæ£€æŸ¥ï¼ˆå–ä»£äº† Validatorï¼‰
- âœ… å­—æ®µè´¨é‡è¯„ä¼°
- âœ… ç½®ä¿¡åº¦æ£€æŸ¥
- âœ… å®Œæ•´æ€§éªŒè¯

---

## ğŸ¯ è¾“å‡ºè´¨é‡ä¿è¯

### å¤šå±‚è´¨é‡æ§åˆ¶ï¼š

1. **Agent è‡ªèº«çš„ç½®ä¿¡åº¦**
   - æ¯ä¸ª Agent è®¡ç®—è‡ªå·±çš„ confidence score
   - è®°å½•åœ¨ `state["confidence_scores"]`

2. **Critic çš„è¯¦ç»†è¯„ä¼°**
   - æ¯æ­¥å Critic æ·±å…¥è¯„ä¼°
   - æä¾› issues å’Œ suggestions
   - å†³å®š Accept/Retry/Escalate

3. **å­—æ®µçº§åˆ«çš„ç½®ä¿¡åº¦**
   - æ¯ä¸ª metadata field æœ‰è‡ªå·±çš„ confidence
   - åŒ…å« evidence è¯´æ˜æ¥æº
   - ä½ç½®ä¿¡åº¦å­—æ®µè‡ªåŠ¨æ ‡è®°

4. **æ‰§è¡Œå†å²è¿½è¸ª**
   - å®Œæ•´è®°å½•æ‰€æœ‰å°è¯•
   - ä¿å­˜æ‰€æœ‰ Critic è¯„ä¼°
   - å¯è¿½æº¯æ‰€æœ‰å†³ç­–

### è´¨é‡æŒ‡æ ‡ï¼š

```python
# æˆåŠŸçš„æ ‡å‡†
overall_confidence > 0.75        âœ… é«˜è´¨é‡
required_fields_present          âœ… å®Œæ•´æ€§
all_fields_have_evidence         âœ… å¯è¿½æº¯
avg_field_confidence > 0.6       âœ… å¯ä¿¡åº¦
```

---

## ğŸ“ˆ æ€§èƒ½å¯¹æ¯”

| æŒ‡æ ‡ | ä¹‹å‰ï¼ˆ4æ­¥ï¼‰ | ç°åœ¨ï¼ˆ3æ­¥ï¼‰ | æ”¹è¿› |
|------|------------|------------|------|
| **æ­¥éª¤æ•°é‡** | 4 | 3 | -25% |
| **å¹³å‡è€—æ—¶** | ~60s | ~45s | -25% |
| **LLM è°ƒç”¨** | 8-10æ¬¡ | 6-8æ¬¡ | -20% |
| **è´¨é‡ä¿è¯** | Validator | Critic | æ›´æ™ºèƒ½ |
| **ä»£ç å¤æ‚åº¦** | é«˜ | ä½ | æ›´ç®€æ´ |

---

## âœ¨ ä¼˜åŠ¿æ€»ç»“

### 1. **æ›´ç®€æ´**
- 3 ä¸ªæ ¸å¿ƒæ­¥éª¤ï¼Œæ¸…æ™°æ˜äº†
- æ¯æ­¥éƒ½æœ‰æ˜ç¡®çš„èŒè´£
- æ˜“äºç†è§£å’Œç»´æŠ¤

### 2. **æ›´é«˜æ•ˆ**
- å‡å°‘ä¸€ä¸ªæ­¥éª¤çš„æ‰§è¡Œæ—¶é—´
- å‡å°‘ LLM API è°ƒç”¨
- æ›´å¿«çš„ç«¯åˆ°ç«¯å¤„ç†

### 3. **è´¨é‡ä¸é™åå‡**
- Critic çš„è¯„ä¼°æ›´å…¨é¢
- å­—æ®µçº§åˆ«çš„è´¨é‡æ§åˆ¶
- å®Œæ•´çš„åé¦ˆå¾ªç¯

### 4. **æ›´çµæ´»**
- JSONGenerator çš„ Critic å¯ä»¥æ£€æŸ¥ä»»ä½•éœ€è¦çš„æ–¹é¢
- ä¸å—å›ºå®šéªŒè¯è§„åˆ™é™åˆ¶
- é€‚åº”ä¸åŒç±»å‹çš„å…ƒæ•°æ®

---

## ğŸ” LangSmith ä¸­çš„ Trace

ç°åœ¨ trace æ›´ç®€æ´ï¼š

```
FAIRifierWorkflow
â”œâ”€ Read Document
â”œâ”€ Orchestrator.Execute
â”‚  â”œâ”€ DocumentParser.Execute
â”‚  â”œâ”€ Critic.EvaluateDocumentParsing
â”‚  â”œâ”€ [å¯èƒ½çš„é‡è¯•]
â”‚  â”œâ”€ KnowledgeRetriever.Execute
â”‚  â”œâ”€ Critic.EvaluateKnowledgeRetrieval
â”‚  â”œâ”€ [å¯èƒ½çš„é‡è¯•]
â”‚  â”œâ”€ JSONGenerator.Execute
â”‚  â”œâ”€ Critic.EvaluateJSONGeneration
â”‚  â””â”€ [å¯èƒ½çš„é‡è¯•]
â””â”€ Finalize Output
```

---

## ğŸ’¡ æœ€ä½³å®è·µ

### è¿è¡Œæ—¶æ£€æŸ¥ï¼š

```bash
# 1. æ£€æŸ¥é…ç½®
python -m fairifier.cli config-info

# 2. è¿è¡Œæµ‹è¯•
python -m fairifier.cli process examples/inputs/test_document.txt --verbose

# 3. æŸ¥çœ‹ç»“æœ
cat output/metadata_json.json | jq '.metadata | length'
# åº”è¯¥æœ‰ 15-25 ä¸ªå­—æ®µ

cat output/metadata_json.json | jq '.metadata[] | select(.confidence < 0.6)'
# æ£€æŸ¥ä½ç½®ä¿¡åº¦å­—æ®µ
```

### åœ¨ LangSmith æ£€æŸ¥ï¼š

1. **æ€»æ­¥éª¤æ•°ï¼š** åº”è¯¥æ˜¯ 3 ä¸ªä¸»è¦æ­¥éª¤
2. **Critic è¯„ä¼°ï¼š** æ¯æ­¥åéƒ½æœ‰
3. **é‡è¯•æ¬¡æ•°ï¼š** æ­£å¸¸æƒ…å†µ 0-2 æ¬¡
4. **æ€»è€—æ—¶ï¼š** 30-60 ç§’

---

## ğŸ‰ ç»“è®º

ç§»é™¤ Validator Agent åï¼š
- âœ… å·¥ä½œæµæ›´ç®€æ´é«˜æ•ˆ
- âœ… è´¨é‡ä¿è¯ä¾ç„¶å……åˆ†
- âœ… Critic çš„è¯„ä¼°æ›´æ™ºèƒ½å…¨é¢
- âœ… å¤„ç†é€Ÿåº¦æå‡ 25%
- âœ… ä»£ç æ›´æ˜“ç»´æŠ¤

**3 æ­¥å·¥ä½œæµ + Critic åé¦ˆ = å®Œç¾çš„è´¨é‡ä¿è¯ï¼** ğŸš€

